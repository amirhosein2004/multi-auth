# 📌 Endpoint: `POST /api/v1/accounts/password/request-password-reset/`

### 🎯 کاربرد:

این API برای درخواست بازنشانی رمز عبور استفاده می‌شود. کاربر شناسه خود (ایمیل یا شماره موبایل) را ارسال می‌کند و در صورت معتبر بودن، یک لینک یا کد تأیید برای ادامه فرآیند دریافت می‌کند.

> این مرحله، **اولین گام** در فرآیند بازیابی رمز عبور است.

---

## 📋 شرایط استفاده

* ✅ فقط کاربران **مهمان (unauthenticated)** مجاز به استفاده هستند.
* ✅ ارسال **توکن کپچا Turnstile** الزامی است.
* ⏱ پس از ارسال موفق، تا **۲ دقیقه** برای همان شناسه امکان ارسال مجدد وجود ندارد.
* 🚦 این endpoint تحت **محدودیت نرخ (Rate Limiting)** است.

---

## 🔐 سطح دسترسی

| شرط                          | وضعیت                        |
| ---------------------------- | ---------------------------- |
| نیاز به لاگین؟               | ❌ خیر (مخصوص مهمان‌ها)       |
| کپچا اجباری؟                 | ✅ بله (Cloudflare Turnstile) |
| محدودیت نرخ (Throttle) فعال؟ | ✅ بله                        |

---

## 📨 درخواست

### ➤ Method: `POST`

### ➤ URL: `/api/v1/accounts/password/request-password-reset/`

---

### Headers

| کلید         | مقدار              |
| ------------ | ------------------ |
| Content-Type | `application/json` |

---

### Body (JSON)

```json
{
  "identity": "user@example.com",
  "cf-turnstile-response": "CAPTCHA_TOKEN"
}
```

| فیلد                    | نوع    | الزامی؟ | توضیح                                        |
| ----------------------- | ------ | ------- | -------------------------------------------- |
| `identity`              | string | ✅       | ایمیل یا شماره موبایل ایرانی (`09xxxxxxxxx`) | 
| `cf-turnstile-response` | string | ✅       | توکن معتبر کپچای Turnstile                   |

---

## 🧪 نمونه‌های معتبر

#### ✅ ارسال ایمیل:

```json
{
  "identity": "user@example.com",
  "cf-turnstile-response": "TOKEN"
}
```

#### ✅ ارسال موبایل:

```json
{
  "identity": "09123456789",
  "cf-turnstile-response": "TOKEN"
}
```

---

## ✅ پاسخ موفق

### ✔️ Status Code: `200 OK`

#### پاسخ برای ایمیل:

```json
{
  "detail": "لینک بازیابی رمز عبور به ایمیل شما ارسال شد.",
  "next_url": "/api/v1/accounts/password/verify-link/",
  "purpose": "reset_password"
}
```

#### پاسخ برای شماره موبایل:

```json
{
  "detail": "کد بازیابی رمز عبور برای شماره شما ارسال شد.",
  "next_url": "/api/v1/accounts/password/verify-otp/",
  "purpose": "reset_password"
}
```

| فیلد      | توضیح                                                        |
| ---------- | ------------------------------------------------------------ |
| `detail`   | پیام موفقیت‌آمیز ارسال لینک یا کد                            |
| `next_url` | مسیر مرحله بعد که کلاینت باید کاربر را به آن هدایت کند       |
| `purpose`  | هدف عملیات که همیشه `reset_password` است                     |

---

## ❌ پاسخ‌های خطا

| کد وضعیت | توضیح                                | نمونه پاسخ                                                                                                      |
| -------- | ------------------------------------ | --------------------------------------------------------------------------------------------------------------- |
| `400`    | ورودی نامعتبر یا کپچا ناموفق         | 👇 نمونه‌ها در ادامه                                                                                            |
| `403`    | کاربر وارد شده و اجازه استفاده ندارد | `{ "detail": "شما قبلاً وارد شده‌اید." }`                                                                       |
| `429`    | عبور از حد مجاز تعداد درخواست        | `{ "detail": "شما بیش از حد مجاز درخواست ارسال کرده‌اید.", "available_in_seconds": 42 }`                      |
| `500`    | خطای داخلی سرور                     | `{ "detail": "خطای ناشناخته‌ای رخ داده است. لطفاً دوباره تلاش کنید." }`                                         |

---

### 📉 نمونه پاسخ 400

#### ❗ شناسه نامعتبر:

```json
{
  "identity": ["ورودی نامعتبر است. لطفاً یک ایمیل یا شماره تلفن معتبر وارد کنید."]
}
```

#### ❗ کپچا ناموفق:

```json
{
  "cf_turnstile_response": ["اعتبارسنجی کپچا ناموفق بود."]
}
```

---
