# مستندسازی سیستم لاگ‌گیری پروژه

این پروژه از یک سیستم لاگ‌گیری پیشرفته مبتنی بر تنظیمات سفارشی جنگو استفاده می‌کند که شامل موارد زیر است:

---

## ساختار کلی لاگ‌گیری

- **پیکربندی اصلی لاگ‌ها** در فایل `backend/settings/logging_config.py` تعریف شده و از طریق متغیر `LOGGING` در تنظیمات اصلی (`base.py`) به جنگو معرفی می‌شود.
- از تابع `logging.config.dictConfig` برای اعمال تنظیمات استفاده می‌شود.
- لاگ‌ها همزمان می‌توانند در کنسول (در حالت توسعه) و فایل‌های مختلف ذخیره شوند.

---

## مسیر و ساختار فایل‌های لاگ

- همه لاگ‌ها در پوشه‌ی `logs/` در ریشه‌ی پروژه ذخیره می‌شوند.
- برای هر اپلیکیشن اصلی (مثلاً `accounts` و `core`) یک فایل لاگ جداگانه وجود دارد:
  - `logs/accounts.log`
  - `logs/core.log`
- لاگ‌های کلی جنگو در `logs/django.log` و لاگ‌های ریشه‌ای در `logs/root.log` ذخیره می‌شوند.

---

## چرخش و نگهداری لاگ‌ها (Log Rotation)

- هر فایل لاگ به صورت روزانه (هر نیمه‌شب) چرخش پیدا می‌کند (rotation).
- حداکثر ۷ نسخه‌ی قدیمی نگهداری می‌شود و نسخه‌های قدیمی‌تر حذف می‌شوند.
- فرمت فایل‌ها UTF-8 است و فرمت لاگ‌ها به شکل زیر است:

  `[2024-06-01 12:00:00,000] [INFO] accounts.views - پیام لاگ`

---

## سطح لاگ (Log Level) بر اساس محیط

- سطح لاگ در حالت توسعه (`dev`) برابر با `DEBUG` و در حالت تولید (`prod`) برابر با `INFO` است.
- تعیین محیط از طریق متغیر محیطی `DJANGO_ENV` انجام می‌شود.
- در حالت توسعه، لاگ‌ها علاوه بر فایل، در کنسول نیز نمایش داده می‌شوند.

---

## ساختار Loggerها و Handlerها

- برای هر اپلیکیشن اصلی یک logger اختصاصی تعریف شده است.
- هر logger می‌تواند پیام‌ها را به فایل مخصوص خود و (در حالت dev) به کنسول ارسال کند.
- logger اصلی جنگو (`django`) و logger ریشه‌ای نیز به همین صورت پیکربندی شده‌اند.
- پیام‌ها قابلیت propagate (انتقال به loggerهای بالادستی) دارند.

---

## ادغام با Sentry (در محیط Production)

- در محیط production، سیستم لاگ با سرویس [Sentry](https://sentry.io) یکپارچه شده است.
- خطاهای سطح `ERROR` و بالاتر به Sentry ارسال می‌شوند.
- اطلاعات کاربر (PII) و نمونه‌ای از تراکنش‌ها نیز برای مانیتورینگ عملکرد ارسال می‌شود.
- تنظیمات Sentry در فایل `prod.py` انجام شده است و نیازمند مقداردهی متغیر محیطی `SENTRY_DSN` است.

---

## نکات مهم

- برای تغییر سطح لاگ یا افزودن اپلیکیشن جدید به لیست لاگ‌های جداگانه، کافیست لیست `APPS` را در `logging_config.py` ویرایش کنید.
- مطمئن شوید پوشه‌ی `logs/` وجود دارد (اسکریپت به صورت خودکار آن را می‌سازد).
- برای مشاهده لاگ‌ها در محیط توسعه، کافیست به فایل‌های داخل پوشه‌ی `logs/` مراجعه کنید یا خروجی کنسول را بررسی نمایید.

---

## نمونه تنظیمات محیطی مرتبط

```env
DJANGO_ENV=dev  # یا prod
SENTRY_DSN=your_sentry_dsn
```

---

در صورت نیاز به شخصی‌سازی بیشتر، می‌توانید ساختار loggerها، handlerها یا formatterها را در فایل `logging_config.py` تغییر دهید.
